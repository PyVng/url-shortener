# –¢–µ—Å—Ç–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ URL Shortener

–≠—Ç–æ—Ç –∫–∞—Ç–∞–ª–æ–≥ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—É—é —Ç–µ—Å—Ç–æ–≤—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ URL Shortener.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
tests/
‚îú‚îÄ‚îÄ setup/                    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ jest.setup.js        # Jest –≥–ª–æ–±–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ test-db.js           # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ unit/                     # Unit —Ç–µ—Å—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ models/
‚îÇ       ‚îî‚îÄ‚îÄ url.test.js      # –¢–µ—Å—Ç—ã –º–æ–¥–µ–ª–∏ URL
‚îú‚îÄ‚îÄ integration/              # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ api/
‚îÇ       ‚îî‚îÄ‚îÄ url.test.js      # API —Ç–µ—Å—Ç—ã –¥–ª—è URL —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ e2e/                      # End-to-End —Ç–µ—Å—Ç—ã
    ‚îú‚îÄ‚îÄ url-shortener/
    ‚îÇ   ‚îî‚îÄ‚îÄ create-link.test.js    # –¢–µ—Å—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è —Å—Å—ã–ª–æ–∫
    ‚îî‚îÄ‚îÄ user-pages/
        ‚îî‚îÄ‚îÄ unauthenticated-access.test.js  # –¢–µ—Å—Ç—ã –¥–æ—Å—Ç—É–ø–∞ –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
```

## –°—Ç–µ–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- **Jest** - –¥–ª—è unit –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
- **Supertest** - –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è HTTP API
- **Playwright** - –¥–ª—è E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±—Ä–∞—É–∑–µ—Ä–∞

## –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### Unit –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
```bash
npm test                    # –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö Jest —Ç–µ—Å—Ç–æ–≤
npm run test:watch         # –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è
npm run test:coverage      # –ó–∞–ø—É—Å–∫ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
```

### E2E —Ç–µ—Å—Ç—ã
```bash
npm run test:e2e           # –ó–∞–ø—É—Å–∫ E2E —Ç–µ—Å—Ç–æ–≤
npm run test:e2e:ui        # –ó–∞–ø—É—Å–∫ —Å Playwright UI
npm run test:e2e:debug     # –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏
```

### –í—Å–µ —Ç–µ—Å—Ç—ã
```bash
npm run test:all           # –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ (Jest + E2E)
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Ç–µ—Å—Ç–æ–≤

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env.test` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
# Database
ACTIVE_DATABASE=sqlite

# Supabase (–¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤)
SUPABASE_URL=your_supabase_url
SUPABASE_ANON_KEY=your_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key

# Test settings
NODE_ENV=test
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–µ—Å—Ç–æ–≤

–¢–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç SQLite –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ `tests/setup/test-db.js`.

## –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

### –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è

‚úÖ **–ú–æ–¥–µ–ª–∏ (Unit —Ç–µ—Å—Ç—ã)**
- –í–∞–ª–∏–¥–∞—Ü–∏—è URL
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ—Ä–æ—Ç–∫–∏—Ö –∫–æ–¥–æ–≤
- –°–æ–∑–¥–∞–Ω–∏–µ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ URL

‚úÖ **API (–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã)**
- –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å—Å—ã–ª–æ–∫
- –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å—Å—ã–ª–∫–∞—Ö
- –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

‚úÖ **–§—Ä–æ–Ω—Ç–µ–Ω–¥ (E2E —Ç–µ—Å—Ç—ã)**
- –ó–∞–≥—Ä—É–∑–∫–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å—Å—ã–ª–æ–∫
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –ù–∞–≤–∏–≥–∞—Ü–∏—è
- –î–æ—Å—Ç—É–ø –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### –ß—Ç–æ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å

üîÑ **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –≤—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏

üîÑ **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏**
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏

üîÑ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
- Rate limiting
- SQL injection –∑–∞—â–∏—Ç–∞
- XSS –∑–∞—â–∏—Ç–∞

üîÑ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
- –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ

## –ù–∞–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

### Unit —Ç–µ—Å—Ç—ã (Jest)

```javascript
const MyModel = require('../models/my-model');

describe('MyModel', () => {
  test('should do something', () => {
    const result = MyModel.someMethod();
    expect(result).toBe(expectedValue);
  });
});
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã API

```javascript
const request = require('supertest');
const app = require('../app');

describe('API /endpoint', () => {
  test('should return success', async () => {
    const response = await request(app)
      .post('/api/endpoint')
      .send({ data: 'test' })
      .expect(200);

    expect(response.body.success).toBe(true);
  });
});
```

### E2E —Ç–µ—Å—Ç—ã (Playwright)

```javascript
import { test, expect } from '@playwright/test';

test('should work', async ({ page }) => {
  await page.goto('/');
  await expect(page.locator('h1')).toContainText('Expected Text');
});
```

## CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

–¢–µ—Å—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤ CI/CD:

- Jest —Ç–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- E2E —Ç–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç headless —Ä–µ–∂–∏–º
- –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –°–∫—Ä–∏–Ω—à–æ—Ç—ã –∏ –≤–∏–¥–µ–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Ç–µ—Å—Ç–æ–≤

## –û—Ç–ª–∞–¥–∫–∞

### –û—Ç–ª–∞–¥–∫–∞ Jest —Ç–µ—Å—Ç–æ–≤
```bash
npm test -- --testNamePattern="specific test name"
npm test -- --verbose --testPathPattern=url.test.js
```

### –û—Ç–ª–∞–¥–∫–∞ E2E —Ç–µ—Å—Ç–æ–≤
```bash
npm run test:e2e:debug
# –∏–ª–∏
npx playwright test --headed --debug
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- Jest: `coverage/lcov-report/index.html`
- Playwright: `test-results/index.html`

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

1. **–ò–∑–æ–ª—è—Ü–∏—è**: –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º
2. **–û—á–∏—Å—Ç–∫–∞**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `beforeEach`/`afterEach` –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
3. **–ú–æ–∫–∏**: –ú–æ–∫–∏—Ä—É–π—Ç–µ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
4. **–û–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è**: –¢–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –æ–±—ä—è—Å–Ω—è—Ç—å —á—Ç–æ –æ–Ω–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç
5. **–ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã**: –°—Ç—Ä–µ–º–∏—Ç–µ—Å—å –∫ —Ç–µ—Å—Ç–∞–º –≤—ã–ø–æ–ª–Ω—è—é—â–∏–º—Å—è < 100ms

## –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ —Ç–µ—Å—Ç–æ–≤:

1. –°–æ–∑–¥–∞–π—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –ø–∞–ø–∫—É –≤ `tests/`
2. –î–æ–±–∞–≤—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ `jest.config.js` –∏–ª–∏ `playwright.config.js`
3. –û–±–Ω–æ–≤–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç—ã –≤ `package.json`
4. –î–æ–±–∞–≤—å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ —ç—Ç–æ—Ç README
