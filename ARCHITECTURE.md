# Обзор архитектуры MVP URL Shortener

## Общая архитектура

Приложение URL Shortener представляет собой минимальный жизнеспособный продукт (MVP) для сокращения длинных URL-адресов в короткие ссылки. Архитектура построена на принципах простоты, масштабируемости и надежности.

## Компоненты системы

### 1. Backend (Flask API)

**Основной файл:** `main.py`

- **Фреймворк:** Flask с поддержкой CORS
- **Архитектура:** REST API с разделением на маршруты
- **Ленивая инициализация:** База данных инициализируется при первом запросе

**Ключевые эндпоинты:**
- `GET /` - обслуживание главной HTML страницы
- `POST /api/shorten` - создание короткого URL
- `GET /api/info/<short_code>` - получение информации о коротком URL
- `GET /<short_code>` - редирект на оригинальный URL
- `GET /api/version` - информация о версии приложения

### 2. Модели данных (SQLAlchemy)

**Основной файл:** `models.py`

- **ORM:** SQLAlchemy с декларативным стилем
- **Основная модель:** `Url` с полями:
  - `id` - первичный ключ
  - `short_code` - уникальный короткий код (6 символов)
  - `original_url` - оригинальный URL
  - `user_id` - идентификатор пользователя (опционально)
  - `title` - заголовок (опционально)
  - `click_count` - счетчик кликов
  - `created_at` - дата создания

**Бизнес-логика:**
- Генерация случайных коротких кодов
- Валидация URL (проверка протокола, длины)
- Увеличение счетчика кликов при редиректе

### 3. Схемы API (Pydantic)

**Основной файл:** `schemas.py`

- **Валидация:** Pydantic модели для входящих и исходящих данных
- **Схемы:**
  - `UrlCreate` - для создания короткого URL
  - `UrlResponse` - для ответа API
  - `UrlInfo` - для информации о URL

### 4. Управление базой данных

**Основной файл:** `database.py`

- **Поддержка нескольких СУБД:**
  - SQLite для локальной разработки
  - PostgreSQL для продакшена (Vercel/Render)
- **Ленивая инициализация:** Engine создается при первом обращении
- **Session management:** SQLAlchemy сессии с автоматическим закрытием

### 5. Frontend (Vanilla JavaScript)

**Основной файл:** `index.html`

- **Технологии:** HTML5, CSS3, ES6 JavaScript
- **Архитектура:** Одностраничное приложение без фреймворков
- **Функциональность:**
  - Форма для ввода URL
  - AJAX запросы к API
  - Отображение результатов
  - Копирование в буфер обмена
  - Валидация URL в реальном времени

## Архитектурные решения

### 1. Выбор технологий

- **Flask:** Легковесный, гибкий, отличная поддержка REST API
- **SQLAlchemy:** Мощная ORM с поддержкой миграций
- **Pydantic:** Строгая валидация данных, автодокументация API
- **Vanilla JS:** Минимальные зависимости, быстрая загрузка

### 2. Масштабируемость

- **База данных:** Поддержка PostgreSQL для продакшена
- **Кэширование:** Возможность добавления Redis для кэширования
- **CDN:** Статические файлы могут быть размещены на CDN

### 3. Безопасность

- **Валидация URL:** Проверка протокола и длины
- **CORS:** Настроен для кросс-доменных запросов
- **SQL Injection:** Предотвращено через SQLAlchemy ORM

### 4. Мониторинг и аналитика

- **Счетчик кликов:** Синхронное увеличение счетчика при каждом редиректе
- **Логирование:** Базовое логирование ошибок
- **Версионирование:** API с информацией о версии

### 5. Объем MVP

MVP реализует только базовый функционал сокращения URL без продвинутых возможностей:

- **Маршрутизация:** Простой редирект без умной маршрутизации (geo/device/referrer/time)
- **A/B тестирование:** Не поддерживается в MVP
- **Правила маршрутизации:** Отложено до следующих версий
- **Асинхронное логирование:** Синхронное увеличение счетчика кликов в Flask
- **Аналитика:** Базовая статистика через API `/api/info/<short_code>`
- **Дашборд:** Отдельный дашборд не требуется, достаточно API + существующего frontend

## Потенциальные улучшения

### Краткосрочные
- Добавление аутентификации пользователей
- Кастомные короткие коды
- Аналитика использования
- QR-коды для коротких ссылок

### Долгосрочные
- Микросервисная архитектура
- Кэширование с Redis
- Асинхронная обработка
- Интеграция с внешними сервисами

## Деплоймент

- **Локальная разработка:** SQLite + Flask dev server
- **Продакшен:** PostgreSQL + Vercel/Render
- **CI/CD:** Автоматическое развертывание при пуше в main

## Тестирование

- **Unit тесты:** Модели, API эндпоинты
- **E2E тесты:** Playwright для пользовательских сценариев
- **Интеграционные тесты:** Проверка работы с базой данных
