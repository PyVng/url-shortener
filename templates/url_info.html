{% extends "base.html" %}

{% block title %}–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Å—ã–ª–∫–µ - {{ short_code }}{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto pb-12 px-4">
    <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-text-primary mb-2">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Å—ã–ª–∫–µ</h1>
        <p class="text-lg text-text-muted">–ö–æ–¥: <code class="mono bg-gray-100 px-2 py-1 rounded">{{ short_code }}</code></p>
    </div>

    <div id="info-container" class="glass p-6 rounded-xl shadow-md">
        <div class="text-center py-8">
            <div class="loading"></div>
            <p class="text-text-muted mt-4">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
        </div>
    </div>
</div>

<script>
// Load URL info on page load
document.addEventListener('DOMContentLoaded', function() {
    fetch(`/api/info/{{ short_code }}`)
        .then(response => response.json())
        .then(data => {
            const container = document.getElementById('info-container');

            if (data.success) {
                const info = data.data;
                container.innerHTML = `
                    <div class="space-y-6">
                        <div>
                            <div class="text-sm font-medium text-text-muted mb-2">–ö–æ—Ä–æ—Ç–∫–∏–π URL:</div>
                            <div class="mono text-text-primary bg-gray-100 p-3 rounded-md break-all">
                                ${window.location.origin}/${info.short_code}
                            </div>
                        </div>

                        <div>
                            <div class="text-sm font-medium text-text-muted mb-2">–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π URL:</div>
                            <a href="${info.original_url}" target="_blank" class="text-primary hover:text-primary-hover break-all">
                                ${info.original_url}
                            </a>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <div class="text-sm font-medium text-text-muted mb-1">–ö–ª–∏–∫–∏:</div>
                                <div class="text-2xl font-bold text-primary">${info.click_count}</div>
                            </div>
                            <div>
                                <div class="text-sm font-medium text-text-muted mb-1">–°–æ–∑–¥–∞–Ω–æ:</div>
                                <div class="text-sm text-text-primary">
                                    ${new Date(info.created_at).toLocaleDateString('ru-RU')}
                                </div>
                            </div>
                        </div>

                        <div class="pt-4 border-t border-gray-200">
                            <div class="flex flex-col sm:flex-row gap-3 mb-4">
                                <a href="${window.location.origin}/${info.short_code}" target="_blank"
                                   class="inline-block bg-primary text-white px-6 py-3 rounded-lg font-medium hover:bg-primary-hover transition-colors shadow-sm text-center">
                                    –ü–µ—Ä–µ–π—Ç–∏ –ø–æ —Å—Å—ã–ª–∫–µ
                                </a>
                                <a href="/analytics/{{ short_code }}"
                                   class="inline-block bg-green-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-green-700 transition-colors shadow-sm text-center">
                                    üìä –ü—Ä–æ—Å–º–æ—Ç—Ä –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
                                </a>
                            </div>

                            <div class="text-center">
                                <a href="/rules" class="text-primary hover:text-primary-hover text-sm underline">
                                    ‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞–º–∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
                                </a>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div class="text-center py-8">
                        <div class="text-4xl mb-4">‚ùå</div>
                        <h2 class="text-xl font-bold text-error mb-2">–°—Å—ã–ª–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</h2>
                        <p class="text-text-muted mb-4">–ö–æ—Ä–æ—Ç–∫–∏–π URL —Å –∫–æ–¥–æ–º "{{ short_code }}" –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç</p>
                        <a href="/" class="inline-block bg-primary text-white px-4 py-2 rounded-md hover:bg-primary-hover transition-colors">
                            –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å—Å—ã–ª–∫—É
                        </a>
                    </div>
                `;
            }
        })
        .catch(error => {
            console.error('Failed to load URL info:', error);
            document.getElementById('info-container').innerHTML = `
                <div class="text-center py-8">
                    <div class="text-4xl mb-4">‚ö†Ô∏è</div>
                    <h2 class="text-xl font-bold text-error mb-2">–û—à–∏–±–∫–∞</h2>
                    <p class="text-text-muted mb-4">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Å—ã–ª–∫–µ</p>
                    <button onclick="location.reload()" class="bg-primary text-white px-4 py-2 rounded-md hover:bg-primary-hover transition-colors">
                        –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                    </button>
                </div>
            `;
        });
});
</script>
{% endblock %}
