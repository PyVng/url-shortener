<!-- Navigation Bar -->
<nav class="glass border-b border-gray-200 fixed top-0 left-0 right-0 z-50 px-4 h-14 flex items-center justify-between shadow-sm">
    <a href="/" class="text-xl font-bold text-text-primary hover:text-primary transition-colors flex items-center gap-2">
        üîó URL Shortener
    </a>

    <div class="flex items-center gap-4">
        <!-- User Info in Navbar -->
        <div id="navbarUserInfo" class="hidden flex items-center gap-3">
            <span id="navbarUserName" class="text-text-primary font-medium"></span>
            <a href="/my-links" class="bg-primary/10 text-primary px-3 py-1.5 rounded-md text-sm font-medium hover:bg-primary/20 transition-colors">
                –ú–æ–∏ —Å—Å—ã–ª–∫–∏
            </a>
            <a href="/rules" class="text-text-muted hover:text-text-primary transition-colors text-sm font-medium px-3 py-1.5">
                –ü—Ä–∞–≤–∏–ª–∞
            </a>
            <button id="navbarLogoutBtn" class="text-text-muted hover:text-text-primary transition-colors text-sm font-medium px-3 py-1.5">
                –í—ã–π—Ç–∏
            </button>
        </div>

        <!-- Auth Links -->
        <div id="navbarAuthLinks" class="flex items-center gap-3">
            <button id="loginBtn" class="text-text-muted hover:text-text-primary transition-colors text-sm font-medium px-3 py-1.5">
                –í–æ–π—Ç–∏
            </button>
            <button id="registerBtn" class="bg-primary text-white px-4 py-1.5 rounded-md text-sm font-medium hover:bg-primary-hover transition-colors shadow-sm">
                –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
            </button>
        </div>
    </div>
</nav>

<script>
class NavbarManager {
    constructor() {
        this.navbarUserInfo = document.getElementById('navbarUserInfo');
        this.navbarAuthLinks = document.getElementById('navbarAuthLinks');
        this.navbarUserName = document.getElementById('navbarUserName');
        this.navbarLogoutBtn = document.getElementById('navbarLogoutBtn');
        this.loginBtn = document.getElementById('loginBtn');
        this.registerBtn = document.getElementById('registerBtn');

        this.init();
    }

    init() {
        // Button clicks
        if (this.loginBtn) {
            this.loginBtn.addEventListener('click', () => this.openAuthModal('login'));
        }
        if (this.registerBtn) {
            this.registerBtn.addEventListener('click', () => this.openAuthModal('register'));
        }

        // Logout
        if (this.navbarLogoutBtn) {
            this.navbarLogoutBtn.addEventListener('click', this.logout.bind(this));
        }

        // Check auth status
        this.checkAuthStatus();
    }

    openAuthModal(type) {
        // Dispatch custom event for modal
        window.dispatchEvent(new CustomEvent('openAuthModal', { detail: { type } }));
    }

    async checkAuthStatus() {
        const token = this.getAuthToken();
        if (!token) {
            this.showAuthLinks();
            return;
        }

        try {
            const response = await fetch('/api/auth/me', {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            if (response.ok) {
                const user = await response.json();
                this.setCurrentUser(user);
            } else {
                this.logout();
            }
        } catch (error) {
            console.warn('Auth check failed:', error);
            this.showAuthLinks();
        }
    }

    setCurrentUser(user) {
        this.navbarUserName.textContent = user.username;
        this.navbarUserInfo.classList.remove('hidden');
        this.navbarAuthLinks.classList.add('hidden');
    }

    logout() {
        localStorage.removeItem('auth_token');
        this.showAuthLinks();
        // Redirect to home
        window.location.href = '/';
    }

    showAuthLinks() {
        this.navbarUserInfo.classList.add('hidden');
        this.navbarAuthLinks.classList.remove('hidden');
    }

    getAuthToken() {
        return localStorage.getItem('auth_token');
    }
}

// Initialize when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    new NavbarManager();
});
</script>
