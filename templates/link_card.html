<!-- Link Card Component -->
<div class="glass p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow">
    <!-- Header with URLs -->
    <div class="mb-4">
        <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium text-text-muted">–ö–æ—Ä–æ—Ç–∫–∞—è —Å—Å—ã–ª–∫–∞:</span>
            <div class="flex gap-2">
                <button
                    onclick="copyToClipboard('{{ short_url }}')"
                    class="text-primary hover:text-primary-hover text-sm underline"
                    id="copyBtn-{{ id }}"
                >
                    –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                </button>
                <a href="{{ short_url }}" target="_blank" class="text-primary hover:text-primary-hover text-sm underline">
                    –û—Ç–∫—Ä—ã—Ç—å
                </a>
            </div>
        </div>
        <div class="mono text-text-primary font-medium text-sm bg-blue-50 border border-blue-200 px-3 py-2 rounded-md break-all">
            {{ short_url }}
        </div>
    </div>

    <!-- Original URL -->
    <div class="mb-4">
        <div class="text-sm font-medium text-text-muted mb-2">–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:</div>
        <div class="text-text-primary text-sm bg-gray-50 px-3 py-2 rounded-md break-all border">
            {{ original_url }}
        </div>
    </div>

    <!-- Stats and Status -->
    <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="text-center p-3 bg-gray-50 rounded-lg">
            <div class="text-lg font-bold text-primary">{{ click_count }}</div>
            <div class="text-xs text-text-muted">–∫–ª–∏–∫–æ–≤</div>
        </div>
        <div class="text-center p-3 bg-gray-50 rounded-lg">
            <div class="text-lg font-bold text-green-600" id="rulesCount-{{ id }}">...</div>
            <div class="text-xs text-text-muted">–ø—Ä–∞–≤–∏–ª</div>
        </div>
    </div>

    <!-- Date -->
    <div class="text-xs text-text-muted mb-4 text-center">
        üìÖ –°–æ–∑–¥–∞–Ω–æ: {{ created_at|strftime('%d.%m.%Y –≤ %H:%M') }}
    </div>

    <!-- Action Buttons -->
    <div class="flex flex-wrap gap-2">
        <a href="/analytics/{{ short_url.split('/')[-1] }}"
           class="flex-1 bg-green-600 text-white px-3 py-2 rounded-md hover:bg-green-700 transition-colors text-sm font-medium text-center">
            üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
        </a>
        <a href="/rules?url_id={{ id }}"
           class="flex-1 bg-blue-600 text-white px-3 py-2 rounded-md hover:bg-blue-700 transition-colors text-sm font-medium text-center">
            ‚öôÔ∏è –ü—Ä–∞–≤–∏–ª–∞
        </a>
        <button onclick="deleteLink({{ id }}, '{{ short_url.split('/')[-1] }}')"
                class="flex-1 bg-red-600 text-white px-3 py-2 rounded-md hover:bg-red-700 transition-colors text-sm font-medium">
            üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
        </button>
    </div>
</div>

<script>
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
        // Find the button that was clicked
        const btn = event.target.closest('button');
        if (btn && btn.id.startsWith('copyBtn-')) {
            const originalText = btn.textContent;
            btn.textContent = '‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
            btn.classList.add('text-green-600');
            btn.classList.remove('text-primary');

            setTimeout(() => {
                btn.textContent = originalText;
                btn.classList.remove('text-green-600');
                btn.classList.add('text-primary');
            }, 2000);
        }
    }).catch(err => {
        console.error('Copy failed:', err);
        // Fallback
        const textArea = document.createElement('textarea');
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);

        const btn = event.target.closest('button');
        if (btn && btn.id.startsWith('copyBtn-')) {
            const originalText = btn.textContent;
            btn.textContent = '‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
            btn.classList.add('text-green-600');
            btn.classList.remove('text-primary');

            setTimeout(() => {
                btn.textContent = originalText;
                btn.classList.remove('text-green-600');
                btn.classList.add('text-primary');
            }, 2000);
        }
    });
}

function deleteLink(urlId, shortCode) {
    if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å—Å—ã–ª–∫—É "${shortCode}"?\n\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!`)) {
        return;
    }

    const token = localStorage.getItem('auth_token');
    if (!token) {
        alert('–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è');
        return;
    }

    fetch(`/api/urls/${urlId}`, {
        method: 'DELETE',
        headers: {
            'Authorization': `Bearer ${token}`
        }
    })
    .then(response => {
        if (response.ok) {
            alert('–°—Å—ã–ª–∫–∞ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞!');
            // Reload the links list
            location.reload();
        } else {
            return response.json().then(data => {
                throw new Error(data.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å—Å—ã–ª–∫–∏');
            });
        }
    })
    .catch(error => {
        console.error('Delete error:', error);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å—Å—ã–ª–∫–∏: ' + error.message);
    });
}

// Load rules count for this URL
document.addEventListener('DOMContentLoaded', function() {
    const rulesCountElement = document.getElementById('rulesCount-{{ id }}');
    if (rulesCountElement) {
        const token = localStorage.getItem('auth_token');
        if (token) {
            fetch(`/api/rules/{{ id }}`, {
                headers: { 'Authorization': `Bearer ${token}` }
            })
            .then(response => response.json())
            .then(data => {
                const count = data.rules ? data.rules.length : 0;
                rulesCountElement.textContent = count;
                if (count > 0) {
                    rulesCountElement.classList.add('text-green-600');
                } else {
                    rulesCountElement.classList.add('text-gray-500');
                }
            })
            .catch(error => {
                console.error('Error loading rules count:', error);
                rulesCountElement.textContent = '0';
                rulesCountElement.classList.add('text-gray-500');
            });
        }
    }
});
</script>
